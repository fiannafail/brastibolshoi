{"version":3,"sources":["webpack:///webpack/bootstrap 0f494dcfcee295d34fb8","webpack:///external \"debug\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/handlers/redis.js","webpack:///./server/models/user.js","webpack:///external \"redis\"","webpack:///./server/config.js","webpack:///external \"koa-passport\"","webpack:///./server/services/jwt-service.js","webpack:///external \"mongoose\"","webpack:///./server/jwt.js","webpack:///external \"jsonwebtoken\"","webpack:///./nuxt.config.js","webpack:///./server/handlers/index.js","webpack:///./server/mongoose-connection.js","webpack:///./server/passport.js","webpack:///./server/routes.js","webpack:///./server/services/socketio.js","webpack:///external \"http\"","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/controllers/cartoon.js","webpack:///./server/controllers/user.js","webpack:///./server/handlers/checkUser.js","webpack:///./server/models/cartoon.js","webpack:///external \"bcrypt\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-router\"","webpack:///external \"mongoose-unique-validator\"","webpack:///external \"passport-local\"","webpack:///external \"regenerator-runtime\"","webpack:///external \"socket.io\"","webpack:///external \"util\"","webpack:///./server/index.js","webpack:///external \"fs\"","webpack:///external \"os\"","webpack:///external \"path\""],"names":["redisClient","redis","createClient","on","err","console","log","require","promisify","getAsync","get","bind","mongoose","plugin","userSchema","username","type","String","unique","required","role","default","email","password","pre","next","isModified","salt","bcrypt","genSaltSync","hashSync","methods","authenticate","compareSync","passwordHash","statics","done","findOne","user","model","MONGO_URI","REDIS_URL","process","env","MONGO_URL","REDIS_KEY","JWT_KEY","genToken","data","expiration","jwt","sign","expiresIn","verify","token","verifyNoExp","ignoreExpiration","debug","ctx","authorization","request","header","jwtService","set","throw","message","module","exports","head","title","meta","charset","name","content","hid","link","rel","href","css","loading","color","build","extend","config","isClient","rules","push","enforce","test","loader","exclude","app","use","bodyParser","Promise","mongoUri","Error","connect","then","mongodb","LocalStrategy","configure","passport","strategyFunc","User","serializeUser","id","deserializeUser","findById","fs","os","path","router","post","signUp","signIn","checkUser","body","Cartoon","add","getAll","getOne","getRedis","getMongo","getCategories","addAgeCategory","files","file","reader","createReadStream","stream","createWriteStream","join","tmpdir","Math","random","toString","pipe","server","io","socket","sockets","msg","category","save","e","AgeCategory","find","categories","cartoon","_id","print","cartoons","slug","params","el","status","accessToken","refreshToken","login","response","decoded","confirmedRefreshToken","newAccessToken","newRefreshToken","ageCategorySchema","description","cartoonSchema","thumb","age","year","Number","video","tags","Array","author","unclear","Schema","Types","ObjectId","ref","host","HOST","port","PORT","dev","nuxt","builder","initialize","initHandlers","mongooseConnector","routes","resolve","reject","res","render","req","promise","catch","http","createServer","callback","websockets","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 32);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0f494dcfcee295d34fb8","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","import redis from 'redis'\nimport { REDIS_KEY, REDIS_URL } from '../config'\n\nexport const redisClient = redis.createClient(REDIS_URL);\n\nredisClient.on(\"error\", function (err) {\n    console.log(\"Error \" + err);\n});\n\nconst { promisify } = require('util');\nexport const getAsync = promisify(redisClient.get).bind(redisClient);\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/handlers/redis.js","import mongoose, { Schema } from 'mongoose'\nimport bcrypt from 'bcrypt'\nimport uniqueValidator from 'mongoose-unique-validator'\n\nmongoose.plugin(uniqueValidator)\n\nconst userSchema = new Schema({\n\tusername: { type: String, unique: true, required: true },\n\trole: { type: String, default: 'user', required: true },\n\temail: { type: String, unique: true, required: true },\n\tpassword: { type: String, required: true }\n})\n\nuserSchema.pre('save', function (next) {\n\tif (!this.isModified('password')) {\n\t\treturn next()\n\t}\n\tconst salt = bcrypt.genSaltSync(10)\n\n\tthis.password = bcrypt.hashSync(this.password, salt)\n\tnext()\n})\n\nuserSchema.methods.authenticate = function (password) {\n\treturn bcrypt.compareSync(password, this.passwordHash)\n}\nuserSchema.statics.authenticate = function (username, password, done) {\n\tconsole.log({ username: username, password: password })\n\tthis.findOne({ username: username }, (err, user) => {\n\t\tif (err) {\n\t\t\tconsole.log('Error to check', err)\n\t\t\tdone(err)\n\t\t} else if (user) {\n\t\t\tconsole.log('Success!', user)\n\t\t\tdone(null, user)\n\t\t} else {\n\t\t\tconsole.log('Something else')\n\t\t\tdone(null, false)\n\t\t}\n\t})\n}\n\nexport default mongoose.model('user', userSchema);\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 4\n// module chunks = 0","let MONGO_URI, REDIS_URL\n\nif(process.env.NODE_ENV === 'production') {\n\tMONGO_URI = process.env.MONGO_URL\n\tREDIS_URL = process.env.REDIS_URL\n} else {\n\tMONGO_URI = 'mongodb://fiannafail:loOhdsdFom5nYCiR@cluster0-shard-00-00-y7wbs.mongodb.net:27017,cluster0-shard-00-01-y7wbs.mongodb.net:27017,cluster0-shard-00-02-y7wbs.mongodb.net:27017/test?ssl=true&replicaSet=Cluster0-shard-0&authSource=admin'\n\tREDIS_URL = 'redis://localhost:6379'\n}\nconst REDIS_KEY = 'DRKlPeBHbgr0FUSs'\nconst JWT_KEY = 'dFTvn3RxVsXE8ZJafmcQSi7fSAL4L9i8'\n\nexport {\n\tMONGO_URI,\n\tREDIS_URL,\n\tJWT_KEY,\n\tREDIS_KEY\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"koa-passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-passport\"\n// module id = 6\n// module chunks = 0","import jwt from 'jsonwebtoken';\nimport { JWT_KEY } from '../config'\n\nexport default {\n  genToken(data, expiration) {\n    return jwt.sign(data, JWT_KEY, { expiresIn: expiration })\n  },\n  verify(token) {\n    return jwt.verify(token, JWT_KEY)\n  },\n  verifyNoExp(token) {\n    return jwt.verify(token, JWT_KEY, { ignoreExpiration: true })\n  }\n};\n\n\n// WEBPACK FOOTER //\n// ./server/services/jwt-service.js","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 8\n// module chunks = 0","import jwtService from './services/jwt-service'\nimport jwt from 'jsonwebtoken'\n\nimport { redisClient, getAsync } from './handlers/redis'\nimport User from './models/user'\n\nconst debug = require('debug')('app:nuxt')\n\nexport default () => async (ctx, next) => {\n\tdebug('jwt start')\n\tconst { authorization } = ctx.request.header\n\tif (!authorization) {\n\t\tconsole.log('next')\n\t\treturn await next()\n\t}\n\tconst { username } = await jwtService.verify(authorization)\n\tdebug('refresh token verified')\n\ttry {\n\t\tconst token = await getAsync(`token_${username}`)\n\t\tctx.set('Authorization', token)\n\t\tctx.set('Refresh-Token', authorization)\n\t\tdebug('jwt access token recieved')\n\t} catch (e) {\n\t\tctx.throw(401, { message: 'Unauthorized. Invalid Token' })\n\t}\n\tawait next()\n}\n\n\n// WEBPACK FOOTER //\n// ./server/jwt.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 10\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' },\n      { rel: 'stylesheet', href: 'https://fonts.googleapis.com/css?family=Roboto+Mono:500|Source+Sans+Pro:300,400,600,700&amp;subset=cyrillic' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: ['~assets/css/main.css'],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n   ** Build configuration\n   */\n  build: {\n    /*\n     ** Run ESLINT on save\n     */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.js$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/,\n      },{\n          enforce: 'pre',\n          test: /\\.vue$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/,\n      })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import bodyParser from 'koa-bodyparser'\n\nexport default (app) => {\n  app.use(bodyParser());\n}\n\n\n// WEBPACK FOOTER //\n// ./server/handlers/index.js","import mongoose from 'mongoose'\nconst debug = require('debug')('app:nuxt')\n\nmongoose.Promise = Promise\n\nexport default (mongoUri) => {\n\tif (!mongoUri) {\n\t\tthrow Error('Mongo uri is undefinded')\n\t}\n\treturn mongoose\n\t\t.connect(mongoUri)\n\t\t.then((mongodb) => {\n\t\t\tdebug('Mongo connected')\n\n\t\t\treturn mongodb\n\t\t})\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/mongoose-connection.js","import passport from 'koa-passport'\nconst LocalStrategy = require('passport-local');\nimport User from './models/user'\n\nconst debug = require('debug')('app:nuxt')\n\nfunction configure(passport) {\n\tconst strategyFunc = function (username, password, done) {\n\t\tUser.authenticate(username, password, function (err, user) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err)\n\t\t\t\tdone(err)\n\t\t\t} else if (user) {\n\t\t\t\tconsole.log('Local - Success')\n\t\t\t\tdone(null, user)\n\t\t\t} else {\n\t\t\t\tconsole.log(err)\n\t\t\t\tdone(null, false)\n\t\t\t}\n\t\t})\n\t}\n\tpassport.use(new LocalStrategy(strategyFunc))\n\n\tpassport.serializeUser(function (user, done) {\n\t\tdone(null, user.id)\n\t})\n\tpassport.deserializeUser(function (id, done) {\n\t\tUser.findById(id, function (err, user) {\n\t\t\tdone(err, user)\n\t\t})\n\t})\n}\n\nmodule.exports = {\n\tconfigure\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/passport.js","import Router from 'koa-router'\nconst debug = require('debug')('app:nuxt')\nconst fs = require('fs');\nconst os = require('os');\nconst path = require('path');\n\nimport User from './controllers/user'\nimport Cartoon from './controllers/cartoon'\n\nimport checkUser from './handlers/checkUser'\nimport putToken from './jwt'\n\nconst router = new Router()\n\nrouter.post('/user', User.signUp)\nrouter.post('/login', User.signIn)\n//\trouter.get('/admin', putToken(), checkUser())\nrouter.get('/custom',\n\tcheckUser(),\n\tasync (ctx, next) => {\n\t\tctx.body = 'Hello!'\n\t\tdebug('page rendered')\n\t})\n\nrouter.post('/addcartoon', Cartoon.add)\nrouter.get('/getcartoons', Cartoon.getAll)\nrouter.get('/cartoon/:slug', Cartoon.getOne)\nrouter.get('/redis', Cartoon.getRedis)\nrouter.get('/mongo', Cartoon.getMongo)\nrouter.get('/getcats', Cartoon.getCategories)\nrouter.post('/addcat', Cartoon.addAgeCategory)\nrouter.post('/upload', async (ctx, next) => {\n\tconsole.log(ctx.request.files)\n\tconst file = ctx.request.body.files.file;\n\tconst reader = fs.createReadStream(file.path);\n\tconst stream = fs.createWriteStream(path.join(os.tmpdir(), Math.random().toString()));\n\treader.pipe(stream);\n\tconsole.log('uploading %s -> %s', file.name, stream.path);\n})\nexport default router\n\n\n// WEBPACK FOOTER //\n// ./server/routes.js","\nimport socket from 'socket.io'\n\n\nexport default (server) => {\n\nconst io = socket(server)\n\nio.sockets.on('connection', (socket) => {\n    console.log('a user connected')\n    socket.on('send-message', (msg) => {\n      console.log(msg)\n    })\n    socket.on('disconnect', () => {\n      console.log('user disconnected')\n    })\n  })\n}\t\n\n\n\n// WEBPACK FOOTER //\n// ./server/services/socketio.js","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 19\n// module chunks = 0","import redis from 'redis'\nimport { Cartoon, AgeCategory } from '../models/cartoon'\nconst debug = require('debug')('app:nuxt')\nimport { redisClient, getAsync } from '../handlers/redis'\n\nexport default {\n\taddAgeCategory: async (ctx, next) => {\n\t\ttry {\n\t\t\tconst category = new AgeCategory(ctx.request.body)\n\t\t\t\t// name: 'half',\n\t\t\t\t// slug: 'half',\n\t\t\t\t// description: 'halfdesc'\n\t\t\tcategory.save()\n\t\t\tctx.body = category\n\t\t} catch (e) {\n\t\t\tconsole.log(e)\n\t\t}\n\t},\n\tgetCategories: async (ctx, next) => {\n\t\ttry {\n\t\t\tconst categories = await AgeCategory.find()\n\t\t\tctx.body = categories\n\t\t} catch (e) {\n\t\t\tconsole.log(e)\n\t\t}\n\t},\n\tadd: async (ctx, next) => {\n\t\ttry {\n\t\t\tconst cartoon = await new Cartoon(ctx.request.body)\n\t\t\tcartoon.save()\n\t\t\tctx.body = cartoon\n\t\t\tawait redisClient.set(`cartoon`, cartoon._id.toString(), redis.print);\n\t\t} catch (e) {\n\t\t\tconsole.log(e)\n\t\t}\n\t},\n\tgetAll: async (ctx, next) => {\n\t\tdebug('start getting')\n\t\tconst cartoons = await Cartoon.find({})\n\t\tif (cartoons) {\n\t\t\tctx.body = cartoons\n\t\t} else {\n\t\t\tctx.body = 'Nothing was found'\n\t\t}\n\t\t\n\t\tdebug('finish getting')\n\t},\n\tgetOne: async (ctx, next) => {\n\t\tconst cartoon = await Cartoon.find({ slug: ctx.params.slug })\n\t\tctx.body = cartoon\n\t},\n\tgetRedis: async (ctx, next) => {\n\t\ttry {\n\t\t\tconst el = await getAsync(`cartoon`)\n\t\t\tctx.body = el\n\t\t} catch(e) {\n\t\t\tconsole.log(e)\n\t\t\tctx.body = e\n\t\t}\n\t},\n\tgetMongo: async (ctx, next) => {\n\t\ttry {\n\t\t\tconst cartoon = await Cartoon.find({ _id: '5a74e75c180fa800bba8fe3e' })\n\t\t\tctx.body = cartoon\n\t\t} catch(e) {\n\t\t\tconsole.log(e)\n\t\t\tctx.body = e\n\t\t}\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/cartoon.js","import redis from 'redis'\nimport passport from 'koa-passport'\nimport User from '../models/user'\nimport jwtService from '../services/jwt-service';\nimport { redisClient, getAsync } from '../handlers/redis'\n\nexport default {\n\tsignUp: async (ctx, next) => {\n\t\tconsole.log(ctx.request.body)\n\t\ttry {\n\t\t\tconst user = await new User(ctx.request.body)\n\t\t\tawait user.save()\n\t\t\tctx.body = user\n\t\t}\n\t\tcatch (err) {\n\t\t\tctx.status = 400;\n\t\t\tctx.body = err\n\t\t\tconsole.log(err)\n\t\t}\n\t},\n\tsignIn: async (ctx, next) => {\n\t\tawait passport.authenticate('local', async (err, user) => {\n\t\t\tconst { email, password } = ctx.request.body;\n\t\t\tif (user == false) {\n\t\t\t\tctx.body = \"Login failed\"\n\t\t\t} else {\n\t\t\t\tconst accessToken = await jwtService.genToken({ id: user._id, username: user.username }, '2m')\n\t\t\t\tconst refreshToken = await jwtService.genToken({ username: user.username }, '30d')\n\t\t\t\tctx.body = { \n\t\t\t\t\taccessToken: accessToken,\n\t\t\t\t\trefreshToken: refreshToken\n\t\t\t\t}\n\t\t\t\tawait redisClient.set(`token_${user.username}`, accessToken, redis.print);\n\t\t\t\tawait redisClient.set(`refreshToken${user.username}`, refreshToken, redis.print);\n\t\t\t\treturn ctx.login(user)\n\t\t\t}\n\t\t})(ctx, next)\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import redis from 'redis'\nimport jwtService from '../services/jwt-service'\nimport User from '../models/user'\nimport { redisClient, getAsync } from '../handlers/redis'\n\nconst debug = require('debug')('app:nuxt')\n\nexport default () => async (ctx, next) => {\n\tdebug('token has not recieved')\n\tconst token = ctx.response.header.authorization\n\tlet decoded = null\n\tif (!token) {\n\t\tctx.throw(403, { message: 'Unauth' })\n\t}\n\ttry {\n\t\tdecoded = await jwtService.verify(token)\n\t} catch (e) {\n\t\tconst refreshToken = ctx.response.header['refresh-token']\n\t\tdecoded = await jwtService.verifyNoExp(token)\n\t\tconst confirmedRefreshToken = await getAsync(`refreshToken${decoded.username}`)\n\t\tif (e.name === 'TokenExpiredError' && confirmedRefreshToken === refreshToken) {\n\t\t\tconst newAccessToken = await jwtService.genToken({ id: decoded._id, username: decoded.username }, '2m')\n\t\t\tconst newRefreshToken = await jwtService.genToken({ username: decoded.username }, '30d')\n\t\t\tawait redisClient.set(`token_${decoded.username}`, newAccessToken, redis.print);\n\t\t\tawait redisClient.set(`refreshToken${decoded.username}`, newRefreshToken, redis.print);\n\t\t}\n\t}\n\tdebug('token recieved')\n\ttry {\n\t\tconst user = await User.findOne({ username: decoded.username })\n\t\tdebug('user found', user)\n\t\tnext()\n\t} catch (e) {\n\t\tctx.throw(403, { message: 'Unauth' })\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./server/handlers/checkUser.js","import mongoose, { Schema } from 'mongoose'\n\nconst ageCategorySchema = new Schema({\n\tname: String,\n\tslug: String,\n\tdescription: String,\n})\n\nconst cartoonSchema = new Schema({\n\ttitle: { type: String },\n\tslug: { type: String },\n\tthumb: { type: String },\n\tage: { type: String },\n\tyear: { type: Number },\n\tvideo: { type: String },\n\ttags: { type: Array },\n\tauthor: { type: String },\n\tunclear: { type: String },\n\tcategory: { type: Schema.Types.ObjectId, ref: 'AgeCategory' }\n})\n\nexport const Cartoon = mongoose.model('Cartoon', cartoonSchema, 'Cartoons')\nexport const AgeCategory = mongoose.model('AgeCategory', ageCategorySchema, 'Categories')\n\n\n// WEBPACK FOOTER //\n// ./server/models/cartoon.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"mongoose-unique-validator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose-unique-validator\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"passport-local\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-local\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 31\n// module chunks = 0","import Koa from 'koa'\nimport http from 'http'\nimport { Nuxt, Builder } from 'nuxt'\nimport passport from 'koa-passport'\nimport router from './routes'\nconst debug = require('debug')('app:nuxt')\nimport mongooseConnector from './mongoose-connection'\nimport initHandlers from './handlers'\nimport jwtHandler from './jwt'\nimport { MONGO_URI, JWT_KEY } from './config'\nimport websockets from './services/socketio'\n\nasync function start () {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 3000\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n  //  Passport\n  app.use(passport.initialize())\n  require('./passport').configure(passport)\n\n  // Initial handlers\n  initHandlers(app)\n\n  // JWT Handler\n  //  app.use(jwtHandler())\n\n  // Mongoose\n  mongooseConnector(MONGO_URI)\n\n  // Router\n  app.use(async (ctx, next) => {\n    await router.routes()(ctx, next)\n  })\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  // socket.io\n  const server = http.createServer(app.callback())\n  websockets(server)\n\n  // listen\n  server.listen(port, host)\n  debug('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 35\n// module chunks = 0"],"sourceRoot":""}